From c3ff279d6e74c88cff68846462572326b3f86f57 Mon Sep 17 00:00:00 2001
From: Vanessa Maegima <vanessa.maegima@foundries.io>
Date: Wed, 7 Jul 2021 12:58:44 -0300
Subject: [PATCH] imx8m: soc.mak: use u-boot-spl-ddr4.bin to build
 flash_evk_spl

Signed-off-by: Vanessa Maegima <vanessa.maegima@foundries.io>
---
 iMX8M/soc.mak | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/iMX8M/soc.mak b/iMX8M/soc.mak
index ad26e9a..a6a44a1 100644
--- a/iMX8M/soc.mak
+++ b/iMX8M/soc.mak
@@ -109,7 +109,7 @@ ddr4_dmem_2d = ddr4_dmem_2d$(DDR_FW_VERSION).bin
 
 u-boot-spl-ddr4.bin: u-boot-spl.bin $(ddr4_imem_1d) $(ddr4_dmem_1d) $(ddr4_imem_2d) $(ddr4_dmem_2d)
 	@objcopy -I binary -O binary --pad-to 0x8000 --gap-fill=0x0 $(ddr4_imem_1d) ddr4_imem_1d_pad.bin
-	@objcopy -I binary -O binary --pad-to 0x4000 --gap-fill=0x0 $(ddr4_dmem_1d) ddr4_dmem_1d_pad.bin
+	dd if=$(ddr4_dmem_1d) of=ddr4_dmem_1d_pad.bin bs=1K count=4
 	@objcopy -I binary -O binary --pad-to 0x8000 --gap-fill=0x0 $(ddr4_imem_2d) ddr4_imem_2d_pad.bin
 	@cat ddr4_imem_1d_pad.bin ddr4_dmem_1d_pad.bin > ddr4_1d_fw.bin
 	@cat ddr4_imem_2d_pad.bin $(ddr4_dmem_2d) > ddr4_2d_fw.bin
@@ -248,8 +248,8 @@ ifeq ($(HDMI),yes)
 flash_evk_spl: $(MKIMG) signed_hdmi_imx8m.bin u-boot-spl-combine u-boot-spl-ddr.bin
 	./mkimage_imx8 -version $(VERSION) -signed_hdmi signed_hdmi_imx8m.bin -loader u-boot-spl-ddr.bin $(SPL_LOAD_ADDR) -out $(OUTIMG)
 else
-flash_evk_spl: $(MKIMG) u-boot-spl-combine u-boot-spl-ddr.bin
-	./mkimage_imx8 -version $(VERSION) -loader u-boot-spl-ddr.bin $(SPL_LOAD_ADDR) -out $(OUTIMG)
+flash_evk_spl: $(MKIMG) u-boot-spl-combine u-boot-spl-ddr4.bin
+	./mkimage_imx8 -version $(VERSION) -loader u-boot-spl-ddr4.bin $(SPL_LOAD_ADDR) -out $(OUTIMG)
 endif
 
 flash_evk_no_hdmi: $(MKIMG) u-boot-spl-ddr.bin u-boot.itb
-- 
2.25.1

