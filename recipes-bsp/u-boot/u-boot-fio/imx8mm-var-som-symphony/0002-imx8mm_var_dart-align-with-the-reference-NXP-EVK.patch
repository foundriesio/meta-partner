From a69ec9a6e7d33d83eb54d8b3a13494baea68fa50 Mon Sep 17 00:00:00 2001
From: FrancescoFerraro <francesco.f@variscite.com>
Date: Mon, 31 Oct 2022 16:45:27 +0100
Subject: [PATCH 02/12] imx8mm_var_dart: align with the reference NXP EVK

Signed-off-by: FrancescoFerraro <francesco.f@variscite.com>
(cherry picked from commit 9c7a5c99063d02acbd0f32ea6163993d2506168d)
Signed-off-by: Vanessa Maegima <vanessa.maegima@foundries.io>
---
 arch/arm/dts/imx8mm-var-common-u-boot.dtsi    | 58 +++++++++---------
 .../imx8mm-var-dart-customboard-u-boot.dtsi   | 16 +++++
 arch/arm/dts/imx8mm-var-dart.dtsi             | 28 ++++++++-
 .../dts/imx8mm-var-som-symphony-u-boot.dtsi   | 20 +++++++
 arch/arm/dts/imx8mm-var-som.dtsi              | 28 ++++++++-
 board/variscite/common/extcon-ptn5150.c       |  1 +
 board/variscite/common/extcon-ptn5150.h       |  1 -
 board/variscite/imx8mm_var_dart/spl.c         | 13 ++--
 configs/imx8mm_var_dart_defconfig             | 60 +++++++++++++------
 include/configs/imx8mm_var_dart.h             | 40 ++-----------
 10 files changed, 172 insertions(+), 93 deletions(-)

diff --git a/arch/arm/dts/imx8mm-var-common-u-boot.dtsi b/arch/arm/dts/imx8mm-var-common-u-boot.dtsi
index 63d88cede78..3bc75f10ebd 100644
--- a/arch/arm/dts/imx8mm-var-common-u-boot.dtsi
+++ b/arch/arm/dts/imx8mm-var-common-u-boot.dtsi
@@ -1,9 +1,11 @@
 // SPDX-License-Identifier: GPL-2.0+
 /*
  * Copyright 2019 NXP
- * Copyright 2019-2020 Variscite Ltd.
+ * Copyright 2019-2022 Variscite Ltd.
  */
 
+#include "imx8mm-u-boot.dtsi"
+
 / {
 	aliases {
 		usbgadget0 = &usbg1;
@@ -30,77 +32,69 @@
 		chipidea,usb = <&usbotg2>;
 		status = "okay";
 	};
-};
-
-&{/soc@0} {
-	u-boot,dm-pre-reloc;
-	u-boot,dm-spl;
-};
 
-&aips1 {
-	u-boot,dm-spl;
-	u-boot,dm-pre-reloc;
+	wdt-reboot {
+		compatible = "wdt-reboot";
+		wdt = <&wdog1>;
+		u-boot,dm-spl;
+	};
 };
 
-&aips2 {
+&crypto {
 	u-boot,dm-spl;
 };
 
-&aips3 {
+&gpio1 {
 	u-boot,dm-spl;
 };
 
-&clk {
+&gpio2 {
 	u-boot,dm-spl;
-	u-boot,dm-pre-reloc;
-	/delete-property/ assigned-clocks;
-	/delete-property/ assigned-clock-parents;
-	/delete-property/ assigned-clock-rates;
 };
 
-&gpio1 {
+&gpio5 {
 	u-boot,dm-spl;
 };
 
-&gpio2 {
+&i2c1 {
 	u-boot,dm-spl;
 };
 
-&gpio5 {
+&pinctrl_i2c1 {
 	u-boot,dm-spl;
 };
 
-&iomuxc {
+&pinctrl_reg_usdhc2_vmmc {
 	u-boot,dm-spl;
 };
 
-&i2c1 {
+&pinctrl_usdhc2 {
 	u-boot,dm-spl;
 };
 
-&osc_24m {
+&pinctrl_usdhc3 {
 	u-boot,dm-spl;
-	u-boot,dm-pre-reloc;
 };
 
-&pinctrl_i2c1 {
+&reg_usdhc2_vmmc {
 	u-boot,dm-spl;
 };
 
-&pinctrl_reg_usdhc2_vmmc {
+&sec_jr0 {
 	u-boot,dm-spl;
 };
 
-&pinctrl_usdhc2 {
+&sec_jr1 {
 	u-boot,dm-spl;
 };
 
-&pinctrl_usdhc3 {
+&sec_jr2 {
 	u-boot,dm-spl;
 };
 
-&reg_usdhc2_vmmc {
-	u-boot,dm-spl;
+&usbotg1 {
+	status = "okay";
+	extcon = <&ptn5150>;
 };
 
 &usdhc2 {
@@ -120,3 +114,7 @@
 	assigned-clock-rates = <400000000>;
 	assigned-clock-parents = <&clk IMX8MM_SYS_PLL1_400M>;
 };
+
+&wdog1 {
+	u-boot,dm-spl;
+};
diff --git a/arch/arm/dts/imx8mm-var-dart-customboard-u-boot.dtsi b/arch/arm/dts/imx8mm-var-dart-customboard-u-boot.dtsi
index dc3c79c6efa..18b481f0f93 100644
--- a/arch/arm/dts/imx8mm-var-dart-customboard-u-boot.dtsi
+++ b/arch/arm/dts/imx8mm-var-dart-customboard-u-boot.dtsi
@@ -1,5 +1,21 @@
 #include "imx8mm-var-common-u-boot.dtsi"
 
+&pinctrl_uart1 {
+	u-boot,dm-spl;
+};
+
 &uart1 {
 	u-boot,dm-spl;
 };
+
+&ethphy0 {
+       vddio0: vddio-regulator {
+               regulator-name = "VDDIO";
+               regulator-min-microvolt = <1800000>;
+               regulator-max-microvolt = <1800000>;
+       };
+};
+
+&fec1 {
+       phy-reset-gpios = <&gpio1 9 GPIO_ACTIVE_LOW>;
+};
diff --git a/arch/arm/dts/imx8mm-var-dart.dtsi b/arch/arm/dts/imx8mm-var-dart.dtsi
index 76b230c906c..31a31df9262 100644
--- a/arch/arm/dts/imx8mm-var-dart.dtsi
+++ b/arch/arm/dts/imx8mm-var-dart.dtsi
@@ -1,6 +1,6 @@
 /*
  * Copyright 2018 NXP
- * Copyright 2018-2020 Variscite Ltd.
+ * Copyright 2018-2022 Variscite Ltd.
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -15,9 +15,15 @@
 
 /dts-v1/;
 
+#include <dt-bindings/usb/pd.h>
 #include "imx8mm.dtsi"
 
 / {
+	memory@40000000 {
+		device_type = "memory";
+		reg = <0x0 0x40000000 0 0x80000000>;
+	};
+
 	reg_eth_phy: regulator-eth-phy {
 		compatible = "regulator-fixed";
 		pinctrl-names = "default";
@@ -29,6 +35,26 @@
 	};
 };
 
+&ddrc {
+	operating-points-v2 = <&ddrc_opp_table>;
+
+	ddrc_opp_table: opp-table {
+		compatible = "operating-points-v2";
+
+		opp-25M {
+			opp-hz = /bits/ 64 <25000000>;
+		};
+
+		opp-100M {
+			opp-hz = /bits/ 64 <100000000>;
+		};
+
+		opp-750M {
+			opp-hz = /bits/ 64 <750000000>;
+		};
+	};
+};
+
 &fec1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_fec1>;
diff --git a/arch/arm/dts/imx8mm-var-som-symphony-u-boot.dtsi b/arch/arm/dts/imx8mm-var-som-symphony-u-boot.dtsi
index b57381792f5..41de2bb33ef 100644
--- a/arch/arm/dts/imx8mm-var-som-symphony-u-boot.dtsi
+++ b/arch/arm/dts/imx8mm-var-som-symphony-u-boot.dtsi
@@ -1,5 +1,25 @@
 #include "imx8mm-var-common-u-boot.dtsi"
 
+&pinctrl_uart4 {
+       u-boot,dm-spl;
+};
+
 &uart4 {
 	u-boot,dm-spl;
 };
+
+&ethphy0 {
+	vddio0: vddio-regulator {
+		regulator-name = "VDDIO";
+		regulator-min-microvolt = <1800000>;
+		regulator-max-microvolt = <1800000>;
+	};
+};
+
+&fec1 {
+	phy-reset-gpios = <&gpio1 9 GPIO_ACTIVE_LOW>;
+};
+
+&gpio4 {
+	u-boot,dm-spl;
+};
diff --git a/arch/arm/dts/imx8mm-var-som.dtsi b/arch/arm/dts/imx8mm-var-som.dtsi
index 3851ac3f7c7..f0bf27ac3e8 100644
--- a/arch/arm/dts/imx8mm-var-som.dtsi
+++ b/arch/arm/dts/imx8mm-var-som.dtsi
@@ -1,6 +1,6 @@
 /*
  * Copyright 2018 NXP
- * Copyright 2018-2020 Variscite Ltd.
+ * Copyright 2018-2022 Variscite Ltd.
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -15,9 +15,15 @@
 
 /dts-v1/;
 
+#include <dt-bindings/usb/pd.h>
 #include "imx8mm.dtsi"
 
 / {
+	memory@40000000 {
+		device_type = "memory";
+		reg = <0x0 0x40000000 0 0x80000000>;
+	};
+
 	reg_eth_phy: regulator-eth-phy {
 		compatible = "regulator-fixed";
 		pinctrl-names = "default";
@@ -30,6 +36,26 @@
 	};
 };
 
+&ddrc {
+	operating-points-v2 = <&ddrc_opp_table>;
+
+	ddrc_opp_table: opp-table {
+		compatible = "operating-points-v2";
+
+		opp-25M {
+			opp-hz = /bits/ 64 <25000000>;
+		};
+
+		opp-100M {
+			opp-hz = /bits/ 64 <100000000>;
+		};
+
+		opp-750M {
+			opp-hz = /bits/ 64 <750000000>;
+		};
+	};
+};
+
 &fec1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_fec1>;
diff --git a/board/variscite/common/extcon-ptn5150.c b/board/variscite/common/extcon-ptn5150.c
index 1b0c064f551..d4a3fe270e1 100644
--- a/board/variscite/common/extcon-ptn5150.c
+++ b/board/variscite/common/extcon-ptn5150.c
@@ -8,6 +8,7 @@
 #include <common.h>
 #include <i2c.h>
 #include <linux/bitfield.h>
+#include <dm.h>
 #include "extcon-ptn5150.h"
 
 int extcon_ptn5150_setup(struct extcon_ptn5150 *port)
diff --git a/board/variscite/common/extcon-ptn5150.h b/board/variscite/common/extcon-ptn5150.h
index ab87599ecae..07ebdb55a18 100644
--- a/board/variscite/common/extcon-ptn5150.h
+++ b/board/variscite/common/extcon-ptn5150.h
@@ -8,7 +8,6 @@
 #ifndef __EXTCON_PTN5150_H
 #define __EXTCON_PTN5150_H
 
-#include <dm.h>
 #include <linux/bitfield.h>
 #include <usb.h>
 
diff --git a/board/variscite/imx8mm_var_dart/spl.c b/board/variscite/imx8mm_var_dart/spl.c
index 8a6c579f6a9..819c41854ad 100644
--- a/board/variscite/imx8mm_var_dart/spl.c
+++ b/board/variscite/imx8mm_var_dart/spl.c
@@ -8,9 +8,10 @@
 #include <common.h>
 #include <cpu_func.h>
 #include <hang.h>
+#include <image.h>
 #include <init.h>
 #include <spl.h>
-#include <asm/io.h>
+#include <asm/global_data.h>
 #include <errno.h>
 #include <asm/io.h>
 #include <asm/mach-imx/iomux-v3.h>
@@ -27,6 +28,7 @@
 #include <asm/arch/ddr.h>
 #include <fsl_sec.h>
 #include <linux/delay.h>
+
 #include "../common/imx8_eeprom.h"
 #include "imx8mm_var_dart.h"
 
@@ -192,7 +194,7 @@ int board_mmc_getcd(struct mmc *mmc)
 	return 1;
 }
 
-#ifdef CONFIG_POWER
+#if CONFIG_IS_ENABLED(POWER_LEGACY)
 #define PMIC_I2C_BUS	0
 int power_init_board(void)
 {
@@ -236,11 +238,10 @@ void spl_board_init(void)
 {
 	struct var_eeprom *ep = VAR_EEPROM_DATA;
 
-#ifdef CONFIG_FSL_CAAM
-	if (sec_init()) {
+if (IS_ENABLED(CONFIG_FSL_CAAM)) {
+	if (sec_init())
 		printf("\nsec_init failed!\n");
-	}
-#endif
+}
 #ifndef CONFIG_SPL_USB_SDP_SUPPORT
 	/* Serial download mode */
 	if (is_usb_boot()) {
diff --git a/configs/imx8mm_var_dart_defconfig b/configs/imx8mm_var_dart_defconfig
index 49f6cb38fff..df14f704fb6 100644
--- a/configs/imx8mm_var_dart_defconfig
+++ b/configs/imx8mm_var_dart_defconfig
@@ -1,14 +1,14 @@
 CONFIG_ARM=y
-CONFIG_SPL_SYS_ICACHE_OFF=y
-CONFIG_SPL_SYS_DCACHE_OFF=y
 CONFIG_ARCH_IMX8M=y
 CONFIG_SYS_TEXT_BASE=0x40200000
-CONFIG_SPL_GPIO_SUPPORT=y
+CONFIG_SYS_MALLOC_LEN=0x2000000
+CONFIG_SYS_MALLOC_F_LEN=0x10000
+CONFIG_SPL_GPIO=y
 CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_NR_DRAM_BANKS=3
 CONFIG_SYS_MEMTEST_START=0x40000000
-CONFIG_SYS_MEMTEST_END=0x50000000
+CONFIG_SYS_MEMTEST_END=0x80000000
 CONFIG_ENV_SIZE=0x4000
 CONFIG_ENV_OFFSET=0x400000
 CONFIG_SYS_I2C_MXC_I2C1=y
@@ -16,40 +16,45 @@ CONFIG_SYS_I2C_MXC_I2C2=y
 CONFIG_SYS_I2C_MXC_I2C3=y
 CONFIG_SYS_I2C_MXC_I2C4=y
 CONFIG_DM_GPIO=y
+CONFIG_DEFAULT_DEVICE_TREE="imx8mm-var-dart-customboard"
 CONFIG_SPL_TEXT_BASE=0x7E1000
 CONFIG_TARGET_IMX8MM_VAR_DART=y
 CONFIG_EXTCON_PTN5150=y
-CONFIG_SPL_MMC_SUPPORT=y
-CONFIG_SPL_SERIAL_SUPPORT=y
-CONFIG_SPL_DRIVERS_MISC_SUPPORT=y
+CONFIG_SPL_MMC=y
+CONFIG_SPL_SERIAL=y
+CONFIG_SPL_DRIVERS_MISC=y
 CONFIG_SPL=y
-CONFIG_DEFAULT_DEVICE_TREE="imx8mm-var-dart-customboard"
 CONFIG_DISTRO_DEFAULTS=y
+CONFIG_SYS_LOAD_ADDR=0x40400000
 CONFIG_FIT=y
 CONFIG_FIT_EXTERNAL_OFFSET=0x3000
+CONFIG_FIT_SIGNATURE=y
 CONFIG_SPL_LOAD_FIT=y
-CONFIG_SPL_FIT_GENERATOR="arch/arm/mach-imx/mkimage_fit_atf.sh"
+# CONFIG_USE_SPL_FIT_GENERATOR is not set
+CONFIG_LEGACY_IMAGE_FORMAT=y
 CONFIG_OF_SYSTEM_SETUP=y
-CONFIG_SYS_EXTRA_OPTIONS="IMX_CONFIG=arch/arm/mach-imx/imx8m/imximage.cfg"
 CONFIG_BOOTDELAY=1
 CONFIG_BOOTCOMMAND="run bsp_bootcmd"
 CONFIG_DEFAULT_FDT_FILE="imx8mm-var-dart.dtb"
-CONFIG_ARCH_MISC_INIT=y
 CONFIG_BOARD_EARLY_INIT_F=y
 CONFIG_BOARD_LATE_INIT=y
 CONFIG_SPL_BOARD_INIT=y
 CONFIG_SPL_SEPARATE_BSS=y
-CONFIG_SPL_I2C_SUPPORT=y
-CONFIG_SPL_POWER_SUPPORT=y
-CONFIG_SPL_USB_HOST_SUPPORT=y
+CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_USE_SECTOR=y
+CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_SECTOR=0x300
+CONFIG_SPL_I2C=y
+CONFIG_SPL_POWER=y
+CONFIG_SPL_USB_HOST=y
 CONFIG_SPL_USB_GADGET=y
 CONFIG_SPL_USB_SDP_SUPPORT=y
+CONFIG_SPL_WATCHDOG=y
 CONFIG_SYS_PROMPT="u-boot=> "
 # CONFIG_BOOTM_NETBSD is not set
 # CONFIG_CMD_EXPORTENV is not set
 # CONFIG_CMD_IMPORTENV is not set
 CONFIG_CMD_ERASEENV=y
 CONFIG_CMD_NVEDIT_EFI=y
+# CONFIG_CMD_CRC32 is not set
 CONFIG_CMD_MEMTEST=y
 CONFIG_CMD_CLK=y
 CONFIG_CMD_DFU=y
@@ -57,7 +62,10 @@ CONFIG_CMD_FUSE=y
 CONFIG_CMD_GPIO=y
 CONFIG_CMD_I2C=y
 CONFIG_CMD_MMC=y
+CONFIG_CMD_OPTEE_RPMB=y
+CONFIG_CMD_POWEROFF=y
 CONFIG_CMD_USB=y
+CONFIG_CMD_USB_MASS_STORAGE=y
 CONFIG_BOOTP_PREFER_SERVERIP=y
 CONFIG_CMD_SNTP=y
 CONFIG_CMD_CACHE=y
@@ -69,6 +77,7 @@ CONFIG_CMD_TIMER=y
 CONFIG_CMD_REGULATOR=y
 CONFIG_CMD_EXT4_WRITE=y
 CONFIG_OF_CONTROL=y
+CONFIG_ENV_OVERWRITE=y
 CONFIG_ENV_IS_IN_MMC=y
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_DEV=1
@@ -91,45 +100,58 @@ CONFIG_GPIO_HOG=y
 CONFIG_MXC_GPIO=y
 CONFIG_DM_PCA953X=y
 CONFIG_DM_I2C=y
-CONFIG_SYS_I2C_MXC=y
-CONFIG_DM_MMC=y
+CONFIG_SPL_SYS_I2C_LEGACY=y
+CONFIG_SUPPORT_EMMC_RPMB=y
 CONFIG_SUPPORT_EMMC_BOOT=y
 CONFIG_MMC_IO_VOLTAGE=y
 CONFIG_MMC_UHS_SUPPORT=y
 CONFIG_MMC_HS400_ES_SUPPORT=y
 CONFIG_MMC_HS400_SUPPORT=y
-CONFIG_FSL_ESDHC_IMX=y
+CONFIG_FSL_USDHC=y
 CONFIG_PHYLIB=y
-CONFIG_PHY_ATHEROS=y
 CONFIG_PHY_ADIN=y
+CONFIG_PHY_ATHEROS=y
 CONFIG_DM_ETH=y
 CONFIG_PHY_GIGE=y
 CONFIG_FEC_MXC=y
 CONFIG_MII=y
 CONFIG_PINCTRL=y
 CONFIG_PINCTRL_IMX8M=y
+CONFIG_SPL_POWER_LEGACY=y
 CONFIG_DM_REGULATOR=y
 CONFIG_DM_REGULATOR_FIXED=y
 CONFIG_DM_REGULATOR_GPIO=y
+CONFIG_SPL_POWER_I2C=y
 CONFIG_DM_RESET=y
 CONFIG_DM_RTC=y
 CONFIG_RTC_EMULATION=y
 CONFIG_MXC_UART=y
 CONFIG_SYSRESET=y
 CONFIG_SYSRESET_PSCI=y
+CONFIG_TEE=y
+CONFIG_OPTEE=y
 CONFIG_DM_THERMAL=y
+CONFIG_IMX_TMU=y
 CONFIG_USB=y
-CONFIG_DM_USB=y
 CONFIG_USB_EHCI_HCD=y
+CONFIG_USB_HOST_ETHER=y
 CONFIG_USB_GADGET=y
 CONFIG_USB_GADGET_MANUFACTURER="Variscite"
 CONFIG_USB_GADGET_VENDOR_NUM=0x0525
 CONFIG_USB_GADGET_PRODUCT_NUM=0xa4a5
 CONFIG_CI_UDC=y
 CONFIG_SDP_LOADADDR=0x40400000
+CONFIG_SPL_RSA=y
+CONFIG_SHA384=y
+CONFIG_LZO=y
+CONFIG_BZIP2=y
 CONFIG_OF_LIBFDT_OVERLAY=y
+CONFIG_EFI_MM_COMM_TEE=y
+CONFIG_EFI_VAR_BUF_SIZE=139264
 CONFIG_EFI_SET_TIME=y
 CONFIG_EFI_RUNTIME_UPDATE_CAPSULE=y
 CONFIG_EFI_CAPSULE_ON_DISK=y
+CONFIG_EFI_IGNORE_OSINDICATIONS=y
 CONFIG_EFI_CAPSULE_FIRMWARE_RAW=y
+CONFIG_EFI_CAPSULE_AUTHENTICATE=y
 CONFIG_EFI_SECURE_BOOT=y
diff --git a/include/configs/imx8mm_var_dart.h b/include/configs/imx8mm_var_dart.h
index 7d3271bd1c0..216ecfdd4cd 100644
--- a/include/configs/imx8mm_var_dart.h
+++ b/include/configs/imx8mm_var_dart.h
@@ -12,11 +12,9 @@
 #include <asm/arch/imx-regs.h>
 #include "imx_env.h"
 
-#define CONFIG_SYS_BOOTM_LEN		(32 * SZ_1M)
+#define CONFIG_SYS_BOOTM_LEN		(64 * SZ_1M)
 #define CONFIG_SPL_MAX_SIZE		(148 * 1024)
 #define CONFIG_SYS_MONITOR_LEN		SZ_512K
-#define CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_USE_SECTOR
-#define CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_SECTOR	(0x300 + CONFIG_SECONDARY_BOOT_SECTOR_OFFSET)
 #define CONFIG_SYS_UBOOT_BASE	\
 	(QSPI0_AMBA_BASE + CONFIG_SYS_MMCSD_RAW_MODE_U_BOOT_SECTOR * 512)
 
@@ -28,23 +26,13 @@
 #define CONFIG_SYS_SPL_MALLOC_SIZE	SZ_512K	/* 512 KB */
 
 /* malloc f used before GD_FLG_FULL_MALLOC_INIT set */
-#define CONFIG_MALLOC_F_ADDR		0x912000
+#define CONFIG_MALLOC_F_ADDR		0x930000
 /* For RAW image gives a error info not panic */
 #define CONFIG_SPL_ABORT_ON_RAW_IMAGE
 
-#define CONFIG_POWER
-#define CONFIG_POWER_I2C
-#if defined(CONFIG_IMX8M_LPDDR4) && defined(CONFIG_TARGET_IMX8MM_EVK)
-#define CONFIG_POWER_PCA9450
-#else
 #define CONFIG_POWER_BD71837
 #endif
 
-#define CONFIG_SYS_I2C
-
-#define CONFIG_SYS_I2C_SPEED		100000
-#endif
-
 #define CONFIG_CMD_READ
 #define CONFIG_SERIAL_TAG
 #define CONFIG_FASTBOOT_USB_DEV 0
@@ -57,7 +45,6 @@
 #define PHY_ANEG_TIMEOUT 20000
 
 #define CONFIG_FEC_XCV_TYPE             RGMII
-#define FEC_QUIRK_ENET_MAC
 #endif
 
 #ifdef CONFIG_DISTRO_DEFAULTS
@@ -89,7 +76,7 @@
 	"bootdir=/boot\0"	\
 	BOOTENV \
 	"scriptaddr=0x43500000\0" \
-	"kernel_addr_r=" __stringify(CONFIG_LOADADDR) "\0" \
+	"kernel_addr_r=" __stringify(CONFIG_SYS_LOAD_ADDR) "\0" \
 	"bsp_script=boot.scr\0" \
 	"image=Image.gz\0" \
 	"img_addr=0x42000000\0"			\
@@ -209,10 +196,6 @@
 
 
 /* Link Definitions */
-#define CONFIG_LOADADDR			0x40480000
-
-#define CONFIG_SYS_LOAD_ADDR		CONFIG_LOADADDR
-
 #define CONFIG_SYS_INIT_RAM_ADDR        0x40000000
 #define CONFIG_SYS_INIT_RAM_SIZE        0x200000
 #define CONFIG_SYS_INIT_SP_OFFSET \
@@ -220,10 +203,6 @@
 #define CONFIG_SYS_INIT_SP_ADDR \
 	(CONFIG_SYS_INIT_RAM_ADDR + CONFIG_SYS_INIT_SP_OFFSET)
 
-#define CONFIG_ENV_OVERWRITE
-
-/* Size of malloc() pool */
-#define CONFIG_SYS_MALLOC_LEN		SZ_32M
 
 /* DDR configs */
 #define CONFIG_SYS_SDRAM_BASE           0x40000000
@@ -245,27 +224,18 @@
 #define CONFIG_IMX_BOOTAUX
 
 /* USDHC */
-#define CONFIG_FSL_USDHC
-
 #define CONFIG_SYS_FSL_USDHC_NUM	2
 #define CONFIG_SYS_FSL_ESDHC_ADDR	0
 
-#define CONFIG_SYS_MMC_IMG_LOAD_PART	1
-
 /* USB configs */
 #ifndef CONFIG_SPL_BUILD
 #define CONFIG_USBD_HS
-
-#define CONFIG_CMD_USB_MASS_STORAGE
-#define CONFIG_USB_GADGET_MASS_STORAGE
-#define CONFIG_USB_FUNCTION_MASS_STORAGE
-
 #endif
 
 #define CONFIG_USB_GADGET_VBUS_DRAW 2
 
-#define CONFIG_MXC_USB_PORTSC		(PORT_PTS_UTMI | PORT_PTS_PTW)
-#define CONFIG_USB_MAX_CONTROLLER_COUNT	2
+#define CONFIG_MXC_USB_PORTSC  (PORT_PTS_UTMI | PORT_PTS_PTW)
+#define CONFIG_USB_MAX_CONTROLLER_COUNT         2
 
 /* Carrier board EEPROM */
 #define CARRIER_EEPROM_BUS_SOM		0x02
-- 
2.34.1

